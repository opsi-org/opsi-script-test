[Actions]
comment "Testing: "
message "GetSectionFromInifile"

DefVar $TestResult$
DefVar $OS$
DefVar $HomeTestFiles$
DefStringList $list1$
DefStringList $CompValue1$
DefStringList $list2$
DefStringList $CompValue2$
DefStringList $test1list1$
DefStringList $test2list1$
DefStringList $test1list2$
DefStringList $test2list2$


; This test needs opsi-script-test.opsiscript to be run first
; That will create the $HomeTestFiles$ file

Set $OS$ = GetOS

switch $OS$
	case "Windows_nt"
		comment "We are running on Windows"
		Set $HomeTestFiles$ = "%opsiTmpDir%\testFiles"
	endcase
	case "Linux"
		comment "We are running on Linux"
		Set $HomeTestFiles$ = "/tmp/opsi-script-test/testFiles"
	endcase
	case "macos"
		comment "We are running on macOS"
		Set $HomeTestFiles$ = "/tmp/opsi-script-test/testFiles"
	endcase
endswitch

;Set $HomeTestFiles$ = "/home/uib/gitwork/opsi-script-test/CLIENT_DATA/test-files/"

if (FileExists($HometestFiles$+"\dummy.ini"))
	;GetSectionFromInifile

	set $list1$ = createStringList ('dummy1=add1', 'dummy2=set1', 'dummy3=change1', 'dummy5=add5', 'replace1=replace1', 'dummy1=addnew1')
	Set $CompValue1$ = GetSectionFromInifile("secdummy", $HometestFiles$+"\dummy.ini")
	
	set $list2$ = createStringList ('dümmy7=üöäßÜÖÄ')
	Set $CompValue2$ = GetSectionFromInifile("secdüöä", $HometestFiles$+"\dummy.ini")
	
	set $test1list1$ = getSubListByMatch($list1$,$CompValue1$)
	set $test2list1$ = getSubListByMatch($CompValue1$,$list1$)
	
	set $test1list2$ = getSubListByMatch($list2$,$CompValue2$)
	set $test2list2$ = getSubListByMatch($CompValue2$,$list2$)
	
	if (count($test1list1$)=count($list1$) AND count($test2list1$)=count($CompValue1$) AND count($test1list2$)=count($list2$) AND count($test2list2$)=count($CompValue2$))
		comment "GetSectionFromInifile passed"
	else
		set $TestResult$ = "not o.k."
		LogWarning "GetSectionFromInifile failed"
	endif
else
	set $TestResult$ = "not o.k."
	logError "Fatal: could not create .ini file"
	isFatalError
endif
